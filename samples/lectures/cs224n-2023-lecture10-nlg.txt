Natural Language Processing
    with Deep Learning
     CS224N/Ling284



                       Xiang Lisa Li
       Lecture 12: Neural Language Generation
  Adapted from slides by Antoine Bosselut and Chris Manning
Announcements

1.   IMPORTANT!!! Remember to sign up for AWS by midnight today!
2.   Proposals due on Tuesday
3.   Assignment 4 just due
4.   Assignment 5 is out and due on Friday 11:59PM, Feb 17th
5.   We will hold a HuggingFace transformers tutorial on Friday




2
Today: Natural Language Generation

1. What is NLG?

2. A review: neural NLG model and training algorithm

3. Decoding from NLG models

4. Training NLG models

5. Evaluating NLG Systems

6. Ethical Considerations




3
What is natural language generation?
Natural language generation is one side of natural
language processing. NLP =
   Natural Language Understanding (NLU) +
   Natural Language Generation (NLG)

NLG focuses on systems that produce fluent, coherent
and useful language output for human consumption

Deep Learning is powering next-gen NLG systems!




4
Example Uses of Natural Language Generation
Machine Translation systems
    input: utterances in source languages
    output: translated text in target languages.


Digital assistant (dialogue) systems use NLG
    input: dialog history
    output: text that respond / continue the conversation


Summarization systems (for research articles,
  email, meetings, documents) use NLG
    input: long documents
5   output: summarization of the long documents
More interesting NLG uses

    Creative stories                      Data-to-text                          Visual description




                                        Craig finished his eleven NFL seasons
                                        with 8,189 rushing yards and 566
                                        receptions for 4,911 receiving yards.




        (Rashkin et al.., EMNLP 2020)        (Parikh et al.., EMNLP 2020)            (Krause et al. CVPR 2017)
6
SOTA NLG system

    ChatGPT is an NLG system!
    It‚Äôs general purpose and can do many NLG tasks!

    e.g., Chatbot:




7
SOTA NLG system

    ChatGPT is an NLG system!
    It‚Äôs general purpose and can do many NLG tasks!

    e.g., Poetry Generation:




8
SOTA NLG system




9
Categorization of NLG tasks
                        Spectrum of open-endedness for Generation Tasks




    Machine
                  Summarization
    Translation




  Source Sentence: ÂΩìÂ±ÄÂ∑≤ÁªèÂÆ£Â∏É‰ªäÂ§©ÊòØËäÇÂÅáÊó•„ÄÇ

  Reference Translation:
  1. Authorities have announced a national holiday today.
  2. Authorities have announced that today is a national holiday.
  3. Today is a national holiday, announced by the authorities.

                           The output space is not very diverse.
Categorization of NLG tasks
                        Spectrum of open-endedness for Generation Tasks




    Machine                             Task-driven       ChitChat
                  Summarization
    Translation                         Dialog            Dialog



   Input: Hey, how are you?

   Outputs:
   1. Good! You?
   2. I just heard an exciting news, do you want to hear it?
   3. Thx for asking! Barely surviving my hws.

                  The output space is getting more diverse‚Ä¶
Categorization of NLG tasks
                        Spectrum of open-endedness for Generation Tasks




    Machine                             Task-driven       ChitChat        Story
                  Summarization
    Translation                         Dialog            Dialog          Generation



    Input: Write a story about three little pigs?
    Outputs:
    ‚Ä¶ (so many options) ‚Ä¶




                     The output space is extremely diverse‚Ä¶
Categorization of NLG tasks

Less Open-ended                                                More Open-ended

        Machine                       Task-driven   ChitChat       Story
                      Summarization
        Translation                   Dialog        Dialog         Generation


     Open-ended generation: the output distribution still has high freedom

     Non-open-ended generation: the input mostly determines the output
     generation.

     Remark: One way of formalizing categorization this is by entropy.
     These two classes of NLG tasks require different decoding and/or training
     approaches!
13
Today: Natural Language Generation

1. What is NLG?

2. A review: neural NLG model and training algorithm

3. Decoding from NLG models

4. Training NLG models

5. Evaluating NLG Systems

6. Ethical Considerations




14
Basics of natural language generation (review of lecture 5)
‚Ä¢ In autoregressive text generation models, at each time step t, our model takes in a
  sequence of tokens as input ùë¶ !" and outputs a new token, ùë¶""
‚Ä¢ For model ùëì( . ) and vocab ùëâ, we get scores ùëÜ = ùëì ùë¶!" , ùúÉ ‚àà ‚Ñù#


                        exp(ùëÜ* )
     ùëÉ ùë¶" ùë¶!"     =                        ùë¶""         ùë¶"")(      ùë¶"")'
                    ‚àë*! ‚àà # exp(ùëÜ*! )
                                                                            ‚Ä¶




                ùë¶"$%     ùë¶"$&      ùë¶"$'     ùë¶"$(        ùë¶""        ùë¶")(
15
Basics of natural language generation (review of lecture 5)
‚Ä¢ For non-open-ended tasks (e.g., MT), we typically use a encoder-decoder system,
  where this autoregressive model serves as the decoder, and we‚Äôd have another
  bidirectional encoder for encoding the inputs.
‚Ä¢ For open-ended tasks (e.g., story generation), this autoregressive generation model is
  often the only component.




16
Trained one token at a time by maximum likelihood
‚Ä¢ Trained to maximize the probability of the next token ùë¶"‚àó given preceding words {ùë¶ ‚àó }!"
                                                   %
                                          ‚Ñí = ‚àí % log ùëÉ ùë¶!‚àó ùë¶ ‚àó     &! )
                                                  !#$
     ‚Ä¢ This is a classification task at each time step trying to predict the actual word ùë¶!‚àó in the training data
     ‚Ä¢ Doing this is often called ‚Äúteacher forcing‚Äù (because you reset at each time step to the ground truth)

                                                                                                   <END>
       ùë¶(‚àó         ùë¶'‚àó         ùë¶&‚àó        ùë¶%‚àó                        ‚àó
                                                                    ùë¶.$&         ‚àó
                                                                                ùë¶.$'        ‚àó
                                                                                           ùë¶.$(      ùë¶.‚àó
                                                        ‚Ä¶




17
       ùë¶-‚àó         ùë¶(‚àó         ùë¶'‚àó        ùë¶&‚àó           ‚Ä¶            ‚àó
                                                                    ùë¶.$%         ‚àó
                                                                                ùë¶.$&        ‚àó
                                                                                           ùë¶.$'         ‚àó
                                                                                                       ùë¶.$(
Basics of natural language generation (review of lecture 5)
‚Ä¢ At inference time, our decoding algorithm defines a function to select a token from this
  distribution:

                    ùë¶!! = ùëî(ùëÉ ùë¶! ùë¶"! ))                 ùëî( . ) is your decoding algorithm


     ‚Ä¢ The ‚Äúobvious‚Äù decoding algorithm is to greedily choose the highest probability next
       token according to the model at each time step

‚Ä¢ While this basic algorithm sort of works, to do better, the two main avenues are to:

     1. Improve decoding
                                                  Of course, there‚Äôs also improving your
                                                  training data or model architecture
     2. Improve the training
18
Today: Natural Language Generation

1. What is NLG?

2. A review: neural NLG model and training algorithm

3. Decoding from NLG models

4. Training NLG models

5. Evaluating NLG Systems

6. Ethical Considerations




19
Decoding: what is it all about?
‚Ä¢ At each time step t, our model computes a vector of scores for each token in our
  vocabulary, S ‚àà ‚Ñù# :
                                    ùëÜ = ùëì ùë¶"!                     ùëì( . ) is your model


‚Ä¢ Then, we compute a probability distribution ùëÉ over these scores with a softmax
  function:
                                                   exp(ùëÜ# )
                    ùëÉ ùë¶! = ùë§ ùë¶"!            =
                                              ‚àë# ! ‚àà % exp(ùëÜ# ! )
‚Ä¢ Our decoding algorithm defines a function to select a token from this distribution:

                               ùë¶!! = ùëî(ùëÉ ùë¶! ùë¶"! ))               ùëî( . ) is your decoding algorithm

20
How to find the most likely string?
‚Ä¢ Recall: Lecture 7 on Neural Machine Translation‚Ä¶
‚Ä¢ Greedy Decoding
   ‚Ä¢ Selects the highest probability token in ùëÉ ùë¶" ùë¶!" )


                           ùë¶!! = ùêöùê´ùê†ùê¶ùêöùê± ùëÉ ùë¶! = ùë§ ùë¶"! )
                                          ùíò‚ààùëΩ

‚Ä¢ Beam Search
   ‚Ä¢ Discussed in Lecture 7 on Machine Translation
   ‚Ä¢ Also aims to find strings that maximize the log-prob, but with wider exploration of
     candidates
       Overall, maximum probability decoding is good for low-entropy tasks like MT and
21     summarization!
The most likely string is repetitive for Open-ended Generation

        Context:     In a shocking finding, scientist discovered a herd
                     of unicorns living in a remote, previously
                     unexplored valley, in the Andes Mountains. Even
                     more surprising to the researchers was the fact
                     that the unicorns spoke perfect English.
     Continuation:   The study, published in the Proceedings of the
                     National Academy of Sciences of the United States of
                     America (PNAS), was conducted by researchers from the
                     Universidad Nacional Aut√≥noma de M√©xico (UNAM)
                     and the Universidad Nacional Aut√≥noma de M√©xico
                     (UNAM/Universidad Nacional Aut√≥noma de M√©xico/
                     Universidad Nacional Aut√≥noma de M√©xico/
                     Universidad Nacional Aut√≥noma de M√©xico/
                     Universidad Nacional Aut√≥noma de M√©xico‚Ä¶
22                                                              (Holtzman et. al., ICLR 2020)
Why does repetition happen?




     A self-amplification effect!
23                                  (Holtzman et. al., ICLR 2020)
And it keeps going‚Ä¶




     Scale doesn‚Äôt solve this problem: even a 175 billion parameter LM still repeats when we
24   decode for the most likely string.                                            (Holtzman et. al., ICLR 2020)
How can we reduce repetition?
Simple option:
‚Ä¢ Heuristic: Don‚Äôt repeat n-grams

More complex:
‚Ä¢ Use a different training objective:
   ‚Ä¢ Unlikelihood objective (Welleck et al., 2020) penalize generation of already-seen tokens
   ‚Ä¢ Coverage loss (See et al., 2017) Prevents attention mechanism from attending to the
     same words
‚Ä¢ Use a different decoding objective:
   ‚Ä¢ Contrastive decoding (Li et al, 2022) searches for strings x that maximize
     logprob_largeLM (x) ‚Äì logprob_smallLM (x).


25
Is finding the most likely string reasonable for open-ended
generation?       a       ar        t i        r ri i

                    1

                   0.8
     Probability



                   0.6

                   0.4

                   0.2

                    0
                         0        20               40              60                 80                  100

                                                        i     t                            a         ar
                                                                                                a

           It fails to match the uncertainty distribution for human generated text.
26                                                                                             (Holtzman et. al., ICLR 2020)
Time to get random : Sampling!
‚Ä¢ Sample a token from the distribution of tokens

                               ùë¶!+ ‚àº ùëÉ ùë¶+ = ùë§ { ùë¶   ,+ )

                                                           restroom
‚Ä¢ It‚Äôs random so you can sample any token!
                                                           grocery
                                                           store
                                                           airport
          He wanted                                        bathroom
          to go to the            Model
                                                           beach
                                                           doctor
                                                           hospital
                                                           pub
                                                           gym
27
Decoding: Top-k sampling
‚Ä¢ Problem: Vanilla sampling makes every token in the vocabulary an option
   ‚Ä¢ Even if most of the probability mass in the distribution is over a limited set of
     options, the tail of the distribution could be very long and in aggregate have
     considerable mass (statistics speak: we have ‚Äúheavy tailed‚Äù distributions)
   ‚Ä¢ Many tokens are probably really wrong in the current context
   ‚Ä¢ For these wrong tokens, we give them individually a tiny chance to be selected.
   ‚Ä¢ But because there are many of them, we still give them as a group a high chance to
     be selected.

‚Ä¢ Solution: Top-k sampling
   ‚Ä¢ Only sample from the top k tokens in the probability distribution


28                                                       (Fan et al., ACL 2018; Holtzman et al., ACL 2018)
Decoding: Top-k sampling
‚Ä¢ Solution: Top-k sampling
   ‚Ä¢ Only sample from the top k tokens in the probability distribution
   ‚Ä¢ Common values are k = 50 (but it‚Äôs up to you!)
                                                                                  restroom
                                                                                  grocery
                                                                                  store
                                                                                  airport
                    He wanted                                                     bathroom
                    to go to the              Model
                                                                                  beach
                                                                                  doctor
                                                                                  hospital
     ‚Ä¢ Increase k yields more diverse, but risky outputs                          pub
     ‚Ä¢ Decrease k yields more safe but generic outputs                            gym
29


                                                           (Fan et al., ACL 2018; Holtzman et al., ACL 2018)
Issues with Top-k sampling



                             Top-k sampling can cut off too quickly!




                             Top-k sampling can also cut off too slowly!



30                                                   (Holtzman et. al., ICLR 2020)
Decoding: Top-p (nucleus) sampling
‚Ä¢ Problem: The probability distributions we sample from are dynamic
   ‚Ä¢ When the distribution Pt is flatter, a limited k removes many viable options
   ‚Ä¢ When the distribution Pt is peakier, a high k allows for too many options to have a
     chance of being selected

‚Ä¢ Solution: Top-p sampling
   ‚Ä¢ Sample from all tokens in the top p cumulative probability mass (i.e., where mass is
     concentrated)
   ‚Ä¢ Varies k depending on the uniformity of Pt




31                                                                      (Holtzman et. al., ICLR 2020)
Decoding: Top-p (nucleus) sampling
‚Ä¢ Solution: Top-p sampling
   ‚Ä¢ Sample from all tokens in the top p cumulative probability mass (i.e., where mass is
     concentrated)
   ‚Ä¢ Varies k depending on the uniformity of Pt



ùëÉ!( ùë¶! = ùë§ { ùë¶       "! )       ùëÉ!) ùë¶! = ùë§ { ùë¶        "! )      ùëÉ!* ùë¶! = ùë§ { ùë¶           "! )




32                                                                      (Holtzman et. al., ICLR 2020)
Decoding: More to go
‚Ä¢ Typical Sampling (Meister et al. 2022)
   ‚Ä¢ Reweights the score based on the entropy of the distribution.
‚Ä¢ Epsilon Sampling (Hewitt et al. 2022)
   ‚Ä¢ Set a threshold for lower bounding valid probabilities.


ùëÉ!( ùë¶! = ùë§ { ùë¶       "! )      ùëÉ!) ùë¶! = ùë§ { ùë¶        "! )     ùëÉ!* ùë¶! = ùë§ { ùë¶          "! )




33                                                                   (Holtzman et. al., ICLR 2020)
Scaling randomness: Temperature
‚Ä¢        Recall: On timestep t, the model computes a prob distribution Pt by applying the softmax function to
         a vector of scores ùë† ‚àà ‚Ñù|(|
                                                            exp(ùëÜ) )
                                           ùëÉ! (ùë¶! = ùë§) =
                                                         ‚àë)*‚àà( exp(ùëÜ)* )

‚Ä¢        You can apply a temperature hyperparameter ùúè to the softmax to rebalance ùëÉ! :
                                                           exp ùëÜ) /ùúè
                                         ùëÉ! ùë¶! = ùë§ =
                                                        ‚àë)! ‚àà( exp ùëÜ)! /ùúè

‚Ä¢        Raise the temperature ùúè > 1: ùëÉ! becomes more uniform
          ‚Ä¢ More diverse output (probability is spread around vocab)
‚Ä¢        Lower the temperature ùúè < 1: ùëÉ! becomes more spiky
          ‚Ä¢ Less diverse output (probability is concentrated on top words)
                                 Temperature is a hyperparameter for decoding:
                              It can be tuned for both beam search and sampling.
    34
Improving Decoding: Re-ranking
‚Ä¢ Problem: What if I decode a bad sequence from my model?

‚Ä¢ Decode a bunch of sequences
   ‚Ä¢ 10 candidates is a common number, but it‚Äôs up to you
‚Ä¢ Define a score to approximate quality of sequences and re-rank by this score
   ‚Ä¢ Simplest is to use (low) perplexity!
       ‚Ä¢ Careful! Remember that repetitive utterances generally get low perplexity.
     ‚Ä¢ Re-rankers can score a variety of properties:
       ‚Ä¢ style (Holtzman et al., 2018), discourse (Gabriel et al., 2021), entailment/factuality (Goyal et al.,
         2020), logical consistency (Lu et al., 2020), and many more ‚Ä¶
       ‚Ä¢ Beware poorly-calibrated re-rankers
     ‚Ä¢ Can compose multiple re-rankers together.

36
Decoding: Takeaways
‚Ä¢ Decoding is still a challenging problem in NLG ‚Äì there‚Äôs a lot more work to be done!

‚Ä¢ Different decoding algorithms can allow us to inject biases that encourage different
  properties of coherent natural language generation

‚Ä¢ Some of the most impactful advances in NLG of the last few years have come from
  simple but effective modifications to decoding algorithms




37
Today: Natural Language Generation

1. What is NLG?

2. A review: neural NLG model and training algorithm

3. Decoding from NLG models

4. Training NLG models

5. Evaluating NLG Systems

6. Ethical Considerations




38
Is repetition due to how LMs are trained?

         Context:    In a shocking finding, scientist discovered a herd
                     of unicorns living in a remote, previously
                     unexplored valley, in the Andes Mountains. Even
                     more surprising to the researchers was the fact
                     that the unicorns spoke perfect English.

     Continuation:   The study, published in the Proceedings of the
                     National Academy of Sciences of the United States of
                     America (PNAS), was conducted by researchers from the
                     Universidad Nacional Aut√≥noma de M√©xico (UNAM)
                     and the Universidad Nacional Aut√≥noma de M√©xico
                     (UNAM/Universidad Nacional Aut√≥noma de M√©xico/
                     Universidad Nacional Aut√≥noma de M√©xico/
                     Universidad Nacional Aut√≥noma de M√©xico/
                     Universidad Nacional Aut√≥noma de M√©xico‚Ä¶
39                                                              (Holtzman et. al., ICLR 2020)
Diversity Issues
‚Ä¢ MLE model learns bad mode of the text distribution.




40
                                                             1

Exposure Bias                                               0.8




                                              Probability
                                                            0.6

                                                            0.4
‚Ä¢ Training with teacher forcing leads to                    0.2
  exposure bias at generation time                           0
                                                                  0         20              40                      60               80                   100
   ‚Ä¢ During training, our model‚Äôs inputs                                                          i         t                             a       ar
     are gold context tokens from real,                                                                                                       a

     human-generated texts                                                                                                                    <END>
                                                                      !#‚àó   !$‚àó     !%‚àó     !(‚àó                       ‚àó
                                                                                                                     !&'%     ‚àó
                                                                                                                             !&'$      ‚àó
                                                                                                                                      !&'#      !&‚àó
                                                                                                        ‚Ä¶


          ‚Ñí456 = ‚àí log ùëÉ ùë¶"‚àó ùë¶ ‚àó    !" )
                                                                      !!‚àó   !#‚àó     !$‚àó     !%‚àó         ‚Ä¶             ‚àó
                                                                                                                     !&'(     ‚àó
                                                                                                                             !&'%      ‚àó
                                                                                                                                      !&'$         ‚àó
                                                                                                                                                  !&'#


     ‚Ä¢ At generation time, our model‚Äôs                                                                                                        <END>
       inputs are previously‚Äìdecoded tokens                                         !($     !("
                                                                                                        ‚Ä¶
                                                                                                                     !(&!(   !(&!"    !(&!$     !(&




           ‚Ñí789 = ‚àí log ùëÉ ùë¶"" ùë¶"   !" )
                                                                                                                ‚Ä¶
                                                                       ‚àó     ‚àó
                                                                      !!"   !!$      !%‚àó    !($       !("            !(&!'   !(&!(    !(&!"       !(&!$
                                                                                  <START>

42
Exposure Bias Solutions
‚Ä¢ Scheduled sampling (Bengio et al., 2015)
   ‚Ä¢ With some probability p, decode a token and feed that as the next input, rather than
     the gold token.
   ‚Ä¢ Increase p over the course of training
   ‚Ä¢ Leads to improvements in practice, but can lead to strange training objectives

‚Ä¢ Dataset Aggregation (DAgger; Ross et al., 2011)
   ‚Ä¢ At various intervals during training, generate sequences from your current model
   ‚Ä¢ Add these sequences to your training set as additional examples


                         Basically, variants of the same approach; see:
                         https://nlpers.blogspot.com/2016/03/a-dagger-by-any-other-name-scheduled.html

43
Exposure Bias Solutions
‚Ä¢ Retrieval Augmentation (Guu*, Hashimoto*, et al., 2018)
   ‚Ä¢ Learn to retrieve a sequence from an existing corpus of human-written prototypes
     (e.g., dialogue responses)
   ‚Ä¢ Learn to edit the retrieved sequence by adding, removing, and modifying tokens in
     the prototype ‚Äì this will still result in a more ‚Äúhuman-like‚Äù generation

‚Ä¢ Reinforcement Learning: cast your text generation model as a Markov decision process
       ‚Ä¢   State s is the model‚Äôs representation of the preceding context
       ‚Ä¢   Actions a are the words that can be generated
       ‚Ä¢   Policy ùúã is the decoder
       ‚Ä¢   Rewards r are provided by an external score
     ‚Ä¢ Learn behaviors by rewarding the model when it exhibits them ‚Äì go study CS 234


44
Reward Estimation
‚Ä¢ How should we define a reward function? Just use your evaluation metric!
   ‚Ä¢ BLEU (machine translation; Ranzato et al., ICLR 2016; Wu et al., 2016)
   ‚Ä¢ ROUGE (summarization; Paulus et al., ICLR 2018; Celikyilmaz et al., NAACL 2018)
   ‚Ä¢ CIDEr (image captioning; Rennie et al., CVPR 2017)
   ‚Ä¢ SPIDEr (image captioning; Liu et al., ICCV 2017)

‚Ä¢ Be careful about optimizing for the task as opposed to ‚Äúgaming‚Äù the reward!
   ‚Ä¢ Evaluation metrics are merely proxies for generation quality!
   ‚Ä¢ ‚Äúeven though RL refinement can achieve better BLEU scores, it barely improves the
     human impression of the translation quality‚Äù ‚Äì Wu et al., 2016



45
Reward Estimation
‚Ä¢ What behaviors can we tie to rewards?
  ‚Ä¢ Cross-modality consistency in image captioning (Ren et al., CVPR 2017)
  ‚Ä¢ Sentence simplicity (Zhang and Lapata, EMNLP 2017)
  ‚Ä¢ Temporal Consistency (Bosselut et al., NAACL 2018)
  ‚Ä¢ Utterance Politeness (Tan et al., TACL 2018)
  ‚Ä¢ Formality (Gong et al., NAACL 2019)

‚Ä¢ Human Preference (RLHF): this is the technique behind ChatGPT!
   ‚Ä¢ (Zieglar et al. 2019, Stiennon et al., 2020)
   ‚Ä¢ Human ranking the generated text based on their preference.
   ‚Ä¢ Learn a reward function of the human preference.          See discussion of RLHF in
                                                                        the next lecture

46
Training: Takeaways
‚Ä¢ Teacher forcing is still the main algorithm for training text generation models



‚Ä¢ Exposure bias causes text generation models to lose coherence easily
   ‚Ä¢ Models must learn to recover from their own bad samples
       ‚Ä¢ E.g., scheduled sampling, DAgger
     ‚Ä¢ Or not be allowed to generate bad text to begin with (e.g., retrieval + generation)

‚Ä¢ Training with RL can allow models to learn behaviors that are preferred by human
  preference / metrics.



48
Today: Natural Language Generation

1. What is NLG?

2. A review: neural NLG model and training algorithm

3. Decoding from NLG models

4. Training NLG models

5. Evaluating NLG Systems

6. Ethical Considerations




49
Types of evaluation methods for text generation




     Ref: They walked to the grocery store .


     Gen: The woman went to the hardware store .




 Content Overlap Metrics                           Model-based Metrics                    Human Evaluations




50                                                             (Some slides repurposed from Asli Celikyilmaz from EMNLP 2020 tutorial)
Content overlap metrics

                          Ref: They walked to the grocery store .


                          Gen: The woman went to the hardware store .

     ‚Ä¢ Compute a score that indicates the lexical similarity between generated and gold-
       standard (human-written) text
     ‚Ä¢ Fast and efficient and widely used
     ‚Ä¢ N-gram overlap metrics (e.g., BLEU, ROUGE, METEOR, CIDEr, etc.)




51
N-gram overlap metrics
Word overlap‚Äìbased metrics (BLEU, ROUGE, METEOR, CIDEr, etc.)

‚Ä¢ They‚Äôre not ideal for machine translation

‚Ä¢ They get progressively much worse for tasks that are more open-ended than machine
  translation
   ‚Ä¢ Worse for summarization, as longer output texts are harder to measure
   ‚Ä¢ Much worse for dialogue, which is more open-ended that summarization
   ‚Ä¢ Much, much worse story generation, which is also open-ended, but whose
     sequence length can make it seem you‚Äôre getting decent scores!



52
A simple failure case
n-gram overlap metrics have no concept of semantic relatedness!

                    Are you enjoying the
                      CS224N lectures?

                                                        Heck yes !
                                Score:
                                 0.61           Yes !

                                  0.25          You know it !

            False negative          0           Yup .

53
            False positive        0.67          Heck no !
Model-based metrics to capture more semantics

     ‚Ä¢ Use learned representations of words and
       sentences to compute semantic similarity
       between generated and reference texts

     ‚Ä¢ No more n-gram bottleneck because text
       units are represented as embeddings!

     ‚Ä¢ The embeddings are pretrained, distance
       metrics used to measure the similarity can
       be fixed



55
 Model-based metrics: Word distance functions

                         Vector Similarity                          Word Mover‚Äôs
                         Embedding based similarity for             Distance
                         semantic distance between text.
                                                                    Measures the distance
                         ‚Ä¢   Embedding Average (Liu et al., 2016)   between two sequences (e.g.,
                         ‚Ä¢   Vector Extrema (Liu et al., 2016)      sentences, paragraphs, etc.),
                         ‚Ä¢   MEANT (Lo, 2017)                       using word embedding
                         ‚Ä¢   YISI (Lo, 2019)
                                                                    similarity matching.
                                                                    (Kusner et.al., 2015; Zhao et al., 2019)




BERTSCORE
Uses pre-trained contextual embeddings from
BERT and matches words in candidate and
reference sentences by cosine similarity.
(Zhang et.al. 2020)

 56
Model-based metrics: Beyond word matching

                                      Sentence Movers Similarity :
                                      Based on Word Movers Distance to evaluate text in a continuous space
                                      using sentence embeddings from recurrent neural network
                                      representations.

                                      (Clark et.al., 2019)




     BLEURT:
     A regression model based on BERT returns a score that
     indicates to what extent the candidate text is grammatical
     and conveys the meaning of the reference text.

     (Sellam et.al. 2020)

57
Evaluating Open-ended Text Generation

     MAUVE
     MAUVE computes information divergence in a quantized embedding
     space, between the generated text and the gold reference text (Pillutla
     et.al., 2022).




58
MAUVE (details)




59
How to evaluate an evaluation metric?




60                                      (Liu et al, EMNLP 2016)
Human evaluations




‚Ä¢ Automatic metrics fall short of matching human decisions

‚Ä¢ Human evaluation is most important form of evaluation for text generation
  systems.

‚Ä¢ Gold standard in developing new automatic metrics
   ‚Ä¢ New automated metrics must correlate well with human evaluations!
61
Human evaluations
     ‚Ä¢ Ask humans to evaluate the quality of generated text

     ‚Ä¢ Overall or along some specific dimension:
        ‚Ä¢ fluency
        ‚Ä¢ coherence / consistency                  Note: Don‚Äôt compare human
        ‚Ä¢ factuality and correctness               evaluation scores across
        ‚Ä¢ commonsense
                                                   differently conducted studies




                                                                                    For details Celikyilmaz, Clark, Gao, 2020
        ‚Ä¢ style / formality
        ‚Ä¢ grammaticality
                                                   Even if they claim to evaluate
                                                   the same dimensions!
        ‚Ä¢ typicality
        ‚Ä¢ redundancy

62
Human evaluation: Issues
‚Ä¢ Human judgments are regarded as the gold standard
‚Ä¢ Of course, we know that human eval is slow and expensive
‚Ä¢ Beyond the cost of human eval, it‚Äôs still far from perfect:

‚Ä¢ Humans Evaluation is hard:
      ‚Ä¢   Results are inconsistent / not reproducible
      ‚Ä¢   can be illogical
      ‚Ä¢   misinterpret your question
      ‚Ä¢   Precision not recall.
      ‚Ä¢   ‚Ä¶



63
Learning from human feedback




ADEM:                                              HUSE:
A learned metric from human judgments for dialog   Human Unified with Statistical Evaluation (HUSE),
system evaluation in a chatbot setting.            determines the similarity of the output distribution
                                                   and a human reference distribution.
(Lowe et.al., 2017)
                                                   (Hashimoto et.al. 2019)
Evaluating LMs by interacting with them


 Evaluating Human Language Model
 Interaction (Lee et al. 2022)

 Prior work:
 Third-party evaluates the quality of
 the output

 This work:
 All the other axes.

65
Evaluation: Takeaways
‚Ä¢ Content overlap metrics provide a good starting point for evaluating the quality of
  generated text, but they‚Äôre not good enough on their own.

‚Ä¢ Model-based metrics can be more correlated with human judgment, but behavior is
  not interpretable

‚Ä¢ Human judgments are critical
   ‚Ä¢ But humans are inconsistent!

‚Ä¢ In many cases, the best judge of output quality is YOU!
   ‚Ä¢ Look at your model generations. Don‚Äôt just rely on numbers!
   ‚Ä¢ Publicly release large samples of the output of systems that you create!

67
Today: Natural Language Generation

1. What is NLG?

2. A review: neural NLG model and training algorithm

3. Decoding from NLG models

4. Training NLG models
                                        Warning:
5. Evaluating NLG Systems               Some of the content on the
6. Ethical Considerations               next few slides may be
                                        disturbing

68
 ChatGPT is heavily filtered to not generated toxic content:




69
But there are still
problems:

jailbreak the detection
tool




        https://twitter.com/semenov_roman_/
        status/1621465137025613825



70
But there are still
problems:

Factual errors.




71
Ethics: Biases in text generation models
(Warning: examples contain sensitive content)



‚Ä¢ Text generation models are often
  constructed from pretrained language
  models

‚Ä¢ Language models learn harmful patterns
  of bias from large language corpora

‚Ä¢ When prompted for this information,
  they repeat negative stereotypes




72                                              (Sheng et al., EMNLP 2019)
Hidden Biases: Universal adversarial triggers
(Warning: examples contain highly sensitive content)




‚Ä¢ Adversarial inputs can trigger VERY
  toxic content

‚Ä¢ These models can be exploited in
  open-world contexts by ill-
  intentioned users




73                                                     (Wallace et al., EMNLP 2019)
Hidden Biases: Triggered innocuously
(Warning: examples contain sensitive content)


‚Ä¢ Pretrained language models can
  degenerate into toxic text even from
  seemingly innocuous prompts

‚Ä¢ Models should not be deployed without
  proper safeguards to control for toxic
  content

‚Ä¢ Models should not be deployed without
  careful consideration of how users will
  interact with it


74                                              (Gehman et al., EMNLP Findings 2020)
Ethics: Think about what you‚Äôre building


‚Ä¢ Large-scale pretrained language models allow us to build NLG
  systems for many new applications

‚Ä¢ Before deploying / publishing NLG models:
   ‚Ä¢ Check if the model‚Äôs output is not harmful
   ‚Ä¢ The model is robust to trigger words
   ‚Ä¢ ‚Ä¶More‚Ä¶




75                                (Zellers et al., NeurIPS 2019)
Concluding Thoughts
‚Ä¢ Interacting with natural language generation systems quickly shows their limitations

‚Ä¢ Even in tasks with more progress, there are still many improvements ahead

‚Ä¢ Evaluation remains a huge challenge.
   ‚Ä¢ We need better ways of automatically evaluating performance of NLG systems

‚Ä¢ With the advent of large-scale language models, deep NLG research has been reset
  ‚Ä¢ It‚Äôs never been easier to jump in the space!

‚Ä¢ One of the most exciting and fun areas of NLP to work in!

76
